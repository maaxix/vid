import{j as e,u as L}from"./index-DyWiTZjq.js";import{b as c,u as M,c as C,L as S}from"./react-Cm8e5hYm.js";function E({open:o,onClose:a,modalType:n="center",children:u}){const r=c.useRef(null),d=M(),i=C();return c.useEffect(()=>{if(!o)return;const l=h=>{h.key==="Escape"&&a()},p=i.pathname+i.search;d(p+"#modal",{replace:!1});const m=()=>{window.location.hash!=="#modal"&&a()};return window.addEventListener("popstate",m),document.body.style.overflow="hidden",window.addEventListener("keydown",l),()=>{document.body.style.overflow="",window.removeEventListener("keydown",l),window.removeEventListener("popstate",m),window.location.hash==="#modal"&&d(p,{replace:!0})}},[]),o?e.jsx("div",{ref:r,className:"modal-overlay",onClick:l=>{l.target===r.current&&a()},children:e.jsx("div",{className:`modal-content box1 p-4 rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 ${P(n,o)}`,onClick:l=>l.stopPropagation(),children:u})}):null}function P(o,a){switch(o){case"top":return`${a?"translate-y-0 opacity-100":"-translate-y-full opacity-0"} mt-4`;case"bottom":return`${a?"translate-y-0 opacity-100":"translate-y-full opacity-0"} mb-4`;case"left":return`${a?"translate-x-0 opacity-100":"-translate-x-full opacity-0"} ml-4`;case"right":return`${a?"translate-x-0 opacity-100":"translate-x-full opacity-0"} mr-4`;case"full":return`${a?"scale-100 opacity-100":"scale-95 opacity-0"}`;case"center":default:return`${a?"scale-100 opacity-100":"scale-95 opacity-0"}`}}function T({open:o,onClose:a,onConfirm:n,title:u="Confirm",message:r="Are you sure?"}){return o?e.jsxs(E,{open:o,onClose:a,modalType:"center",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:u}),e.jsx("p",{className:"mb-4",children:r}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,className:"btn second",children:"Cancel"}),e.jsx("button",{onClick:()=>{n(),a()},className:"btn primary",children:"Confirm"})]})]}):null}function R({open:o,onClose:a,initial:n,onSave:u}){const[r,d]=c.useState({name:"",url:"",apiKey:""});return c.useEffect(()=>{d(n||{name:"",url:"",apiKey:""})},[n]),o?e.jsxs(E,{open:o,onClose:a,modalType:"bottom",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:n?"Edit Server":"Add Server"}),e.jsx("input",{className:"border p-2 rounded w-full mb-2",placeholder:"Name",value:r.name,onChange:i=>d(l=>({...l,name:i.target.value})),disabled:!!n}),e.jsx("input",{className:"border p-2 rounded w-full mb-2",placeholder:"URL",value:r.url,onChange:i=>d(l=>({...l,url:i.target.value}))}),e.jsx("input",{className:"border p-2 rounded w-full mb-4",placeholder:"API Key",value:r.apiKey,onChange:i=>d(l=>({...l,apiKey:i.target.value}))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,className:"btn second",children:"Cancel"}),e.jsx("button",{onClick:()=>u(r),className:"btn primary",children:"Save"})]})]}):null}function I(){const a=C().pathname,{config:n,updateConfig:u}=L(),[r,d]=c.useState({}),[i,l]=c.useState({}),[p,m]=c.useState(!1),[h,x]=c.useState(!1),[k,j]=c.useState(null),[v,w]=c.useState(null);c.useEffect(()=>{if(n!=null&&n.servers){const t={};n.serverOrder.forEach(s=>{n.servers[s]&&(t[s]={name:s,...n.servers[s]})}),d(t)}},[n]),c.useEffect(()=>{const t=async()=>{const s={};await Promise.all(Object.entries(r).map(async([f,y])=>{try{(await fetch(`${y.url}/api/ping`,{method:"GET"})).ok?s[f]="online":s[f]="offline"}catch{s[f]="offline"}})),l(s)};Object.keys(r).length>0&&t()},[r]);const g=t=>{const s={},f=[];Object.entries(t).forEach(([b,N])=>{s[b]={url:N.url,apiKey:N.apiKey},f.push(b)});const y={...n,servers:s,serverOrder:f};u(y)},$=()=>{j(null),m(!0)},O=t=>{const s=r[t];s&&(j({...s}),m(!0))},K=t=>{w(t),x(!0)},A=()=>{if(v){const t={...r};delete t[v],g(t),w(null)}x(!1)},D=t=>{const s={...r,[t.name]:{name:t.name,url:t.url,apiKey:t.apiKey}};g(s),m(!1)};return e.jsxs("div",{className:"box",children:[e.jsxs("h4",{className:"flex card-header",children:[e.jsx("span",{className:"grow",children:"Server Manager"}),e.jsx("nav",{className:"",children:e.jsx("button",{onClick:$,className:"btn",children:"Add Server"})})]}),e.jsx("div",{className:"card-body flex-col gap-4",children:Object.entries(r).map(([t,s])=>e.jsxs("div",{className:"card flex gap-2 box p-2",children:[e.jsxs(S,{to:`${a}/${s.name}`,className:"grow",children:[e.jsx("h4",{className:"text-lg font-semibold",children:t}),e.jsx("p",{className:"text-sm text-gray-500",children:s.url}),e.jsxs("p",{className:`text-sm mt-1 ${i[t]==="online"?"text-green-600":"text-red-600"}`,children:["Status: ",i[t]||"unknown"]})]}),e.jsxs("div",{className:"",children:[e.jsx(S,{to:`${a}/${s.name}/settings`,className:"btn",children:"Settings"}),e.jsx("button",{onClick:()=>O(t),className:"btn",children:"Edit"}),e.jsx("button",{onClick:()=>K(t),className:"btn",children:"Delete"})]})]},t))}),e.jsx(R,{open:p,onClose:()=>m(!1),onSave:D,initial:k||void 0}),e.jsx(T,{open:h,onClose:()=>x(!1),onConfirm:A,title:"Delete Server",message:`Are you sure you want to delete server "${v}"?`})]})}export{I as default};
