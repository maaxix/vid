import{j as e}from"./index-DGs7CRWL.js";import{b as a,e as L}from"./react-WPAQU5kY.js";import{m as U}from"./MediaServersService-vjLaEZ2q.js";const V=t=>{const r=Math.floor(t/3600),n=Math.floor(t%3600/60),s=Math.floor(t%60);return r>0?`${r}:${n.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${n}:${s.toString().padStart(2,"0")}`},R=t=>new Date(t).toLocaleDateString(),B=({video:t,baseServerUrl:r})=>{var c;const n=t.dataTitle||t.filename,s=((c=t.thumbnailsTime)==null?void 0:c[0])||0,l=`${r}/api/media/data/thumbs/${t.fileId}/${s}`,u=`${r}/api/media/stream/${t.fileId}`;return e.jsx("div",{className:"card-wrapper",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"relative",children:[e.jsx("a",{href:u,target:"__blank",children:e.jsx("img",{src:l,alt:n,className:"w-full h-48 object-cover",onError:x=>{x.target.src=""}})}),e.jsx("div",{className:"pill small vid-time",children:V(t.duration)})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"card-title mb-2",title:n,children:n}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx("span",{className:"pill small",children:R(t.fileUpdateDate)}),e.jsxs("span",{className:"pill small",children:[Math.round(t.fileSize/(1024*1024))," MB"]})]})]})]})})},C=({onSearch:t})=>{const[r,n]=a.useState(""),s=l=>{l.key==="Enter"&&t(r)};return e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",placeholder:"Search videos...",className:"grow",value:r,onChange:l=>n(l.target.value),onKeyDown:s}),e.jsx("button",{className:"btn second",onClick:()=>t(r),children:"Search"})]})};function _(){const{id:t}=L(),[r,n]=a.useState([]),[s,l]=a.useState(!1),[u,c]=a.useState(null),[x,E]=a.useState(""),[j,N]=a.useState(1),[b,P]=a.useState(1),[S,D]=a.useState(""),[o,M]=a.useState(!0),m=a.useRef(null),g=a.useRef(null),h=a.useCallback(async(i,f="",w=!1)=>{if(!s){l(!0),c(null);try{const d=U.findServerByName(t||"");if(!d)throw new Error(`Endpoint with name "${t}" not found`);const y=d.url,p=new URL(y+"/api/media/search",window.location.origin);f&&p.searchParams.append("q",f),p.searchParams.append("page",i.toString()),p.searchParams.append("limit","20");const $=await fetch(p.toString());if(!$.ok)throw new Error("Failed to fetch videos");const v=await $.json();n(w?v.results:I=>[...I,...v.results]),P(v.totalPages),N(i),E(y)}catch(d){c(d instanceof Error?d.message:"An unknown error occurred")}finally{l(!1),o&&M(!1)}}},[s,o]),k=i=>{D(i),N(1),h(1,i,!0)};return a.useEffect(()=>{if(o){h(1,S,!0);return}const i={root:null,rootMargin:"20px",threshold:1};return m.current=new IntersectionObserver(f=>{f[0].isIntersecting&&j<b&&!s&&h(j+1,S)},i),g.current&&m.current.observe(g.current),()=>{m.current&&m.current.disconnect()}},[j,b,s,S,o,h]),e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"card-title p-3 title-primary",children:"Video Search"}),e.jsx(C,{onSearch:k}),u&&e.jsx("div",{className:"card-body border-red-400 text-red-700 px-4",children:u}),!o&&r.length===0&&!s&&e.jsx("div",{className:"card-body text-center py-12",children:e.jsx("p",{className:"text-xl text-gray-600",children:"No videos found"})}),r.length>0&&e.jsx("div",{className:"card-title p-3 title-primary",children:"Video List"}),e.jsx("div",{className:"container-grid",children:r.map(i=>e.jsx(B,{video:i,baseServerUrl:x},i.fileId))}),e.jsx("div",{ref:g,className:"h-10"}),s&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})]})}export{_ as default};
