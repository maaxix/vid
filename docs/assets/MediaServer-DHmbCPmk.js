import{j as e,u as C}from"./index-wKzmwJjn.js";import{b as s,e as L}from"./react-DWbSL3I3.js";const R=t=>{const r=Math.floor(t/3600),n=Math.floor(t%3600/60),l=Math.floor(t%60);return r>0?`${r}:${n.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`:`${n}:${l.toString().padStart(2,"0")}`},V=t=>new Date(t).toLocaleDateString(),T=({video:t,baseServerUrl:r})=>{var c;const n=t.dataTitle||t.filename,l=((c=t.thumbnailsTime)==null?void 0:c[0])||0,a=`${r}/api/media/data/thumbs/${t.fileId}/${l}`,d=`${r}/api/media/stream/${t.fileId}`;return e.jsx("div",{className:"card-wrapper",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"relative",children:[e.jsx("a",{href:d,target:"__blank",children:e.jsx("img",{src:a,alt:n,className:"w-full h-48 object-cover",onError:u=>{u.target.src=""}})}),e.jsx("div",{className:"absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded",children:R(t.duration)})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",title:n,children:n}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx("span",{className:"bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded",children:V(t.fileUpdateDate)}),e.jsxs("span",{className:"bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded",children:[Math.round(t.fileSize/(1024*1024)),"MB"]})]})]})]})})},B=({onSearch:t})=>{const[r,n]=s.useState(""),l=a=>{a.key==="Enter"&&t(r)};return e.jsxs("div",{className:"relative max-w-2xl w-full",children:[e.jsx("input",{type:"text",placeholder:"Search videos...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:r,onChange:a=>n(a.target.value),onKeyDown:l}),e.jsx("button",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-500 text-white px-4 py-1 rounded-md hover:bg-blue-600 focus:outline-none",onClick:()=>t(r),children:"Search"})]})};function _(){const{id:t}=L(),{config:r}=C(),[n,l]=s.useState([]),[a,d]=s.useState(!1),[c,u]=s.useState(null),[E,P]=s.useState(""),[p,S]=s.useState(1),[y,k]=s.useState(1),[g,D]=s.useState(""),[i,M]=s.useState(!0),h=s.useRef(null),b=s.useRef(null);console.log(`id=${t}`);const f=s.useCallback(async(o,m="",w=!1)=>{if(!a){d(!0),u(null);try{if(!r.servers[t||""])throw new Error(`Endpoint with name "${t}" not found`);const N=r.servers[t||""].url;console.log("serves"),console.log(r.servers);const x=new URL(N+"/api/media/search",window.location.origin);m&&x.searchParams.append("q",m),x.searchParams.append("page",o.toString()),x.searchParams.append("limit","20");const $=await fetch(x.toString());if(!$.ok)throw new Error("Failed to fetch videos");const v=await $.json();l(w?v.results:U=>[...U,...v.results]),k(v.totalPages),S(o),P(N)}catch(j){u(j instanceof Error?j.message:"An unknown error occurred")}finally{d(!1),i&&M(!1)}}},[a,i]),I=o=>{D(o),S(1),f(1,o,!0)};return s.useEffect(()=>{if(i){f(1,g,!0);return}const o={root:null,rootMargin:"20px",threshold:1};return h.current=new IntersectionObserver(m=>{m[0].isIntersecting&&p<y&&!a&&f(p+1,g)},o),b.current&&h.current.observe(b.current),()=>{h.current&&h.current.disconnect()}},[p,y,a,g,i,f]),e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"card-header",children:"Video Search"}),e.jsx(B,{onSearch:I}),c&&e.jsx("div",{className:"card-body border-red-400 text-red-700 px-4",children:c}),!i&&n.length===0&&!a&&e.jsx("div",{className:"card-body text-center py-12",children:e.jsx("p",{className:"text-xl text-gray-600",children:"No videos found"})}),e.jsx("div",{className:"container-grid",children:n.map(o=>e.jsx(T,{video:o,baseServerUrl:E},o.fileId))}),e.jsx("div",{ref:b,className:"h-10"}),a&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})]})}export{_ as default};
