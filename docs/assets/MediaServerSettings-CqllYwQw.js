import{j as e}from"./index-DGs7CRWL.js";import{e as E,b as c}from"./react-WPAQU5kY.js";import{m as x}from"./MediaServersService-vjLaEZ2q.js";const C=async r=>{const s=await fetch(`${r}/api/dir`);if(!s.ok)throw new Error("Failed to fetch media directory");return await s.json()},D=async(r,s)=>{const n=await fetch(`${r}/api/dir`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok)throw new Error("Failed to create media directory");return await n.json()},F=async(r,s,n)=>{const m=await fetch(`${r}/api/dir/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!m.ok)throw new Error("Failed to update media directory");return await m.json()},k=async(r,s)=>{if(!(await fetch(`${r}/api/dir/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete media directory")};function L(){const{id:r}=E(),[s,n]=c.useState([]),[m,i]=c.useState(null),[f,o]=c.useState(!1),[h,j]=c.useState(!1),[l,p]=c.useState({name:"",path:""});c.useEffect(()=>{if(!r){i("Server ID is missing");return}const t=x.findServerByName(r);if(!t){i(`Not Found server ${r}`);return}t&&v(t.url)},[r]);const v=async t=>{o(!0);try{const a=await C(t);n(a),i(null)}catch(a){i(a instanceof Error?a.message:"Failed to load media servers")}finally{o(!1)}},y=t=>{const{name:a,value:d}=t.target;p(u=>({...u,[a]:d}))},N=async t=>{if(t.preventDefault(),!(!l.name||!l.path)){o(!0);try{const a=x.findServerByName(r||"");if(!a)throw new Error("Server configuration not found");if(h){const d=await F(a.url,l.name,l);n(s.map(u=>u.name===d.name?d:u))}else{const d=await D(a.url,l);n([...s,d])}b(),i(null)}catch(a){i(a instanceof Error?a.message:"Failed to save media server")}finally{o(!1)}}},w=t=>{p(t),j(!0)},g=async t=>{if(window.confirm("Are you sure you want to delete this directory?")){o(!0);try{const a=x.findServerByName(r||"");if(!a)throw new Error("Server configuration not found");await k(a.url,t),n(s.filter(d=>d.name!==t)),i(null)}catch(a){i(a instanceof Error?a.message:"Failed to delete media server")}finally{o(!1)}}},b=()=>{p({name:"",path:""}),j(!1)},S=()=>{};return e.jsxs("div",{className:"box",children:[e.jsxs("div",{className:"flex card-header",children:[e.jsx("span",{className:"grow card-title title-primary",children:"Media Directories"}),e.jsx("nav",{className:"",children:e.jsxs("button",{onClick:S,className:"btn second tooltip",children:["Add Directory",e.jsx("span",{className:"tooltip-top tooltiptext",children:"Add Server"})]})})]}),e.jsxs("div",{className:"card-body flex-col gap-6",children:[m&&e.jsx("div",{className:"alert alert-danger",children:m}),e.jsx("div",{className:"box p-2",children:e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"fld",children:[e.jsx("label",{htmlFor:"name",className:"fld-label",children:"Name"}),e.jsx("input",{type:"text",className:"fld-input",id:"name",name:"name",value:l.name,onChange:y,required:!0,disabled:h})]}),e.jsxs("div",{className:"fld",children:[e.jsx("label",{htmlFor:"path",className:"fld-label",children:"Path"}),e.jsx("input",{type:"text",className:"fld-input",id:"path",name:"path",value:l.path,onChange:y,required:!0})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",className:"btn primary",disabled:f,children:h?"Update":"Create"}),h&&e.jsx("button",{type:"button",className:"btn second",onClick:b,disabled:f,children:"Cancel"})]})]})}),e.jsx("div",{className:"card-body",children:f?e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs("table",{className:"table table-striped",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Path"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{children:t.path}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>w(t),className:"btn btn-sm btn-warning me-2",children:"Edit"}),e.jsx("button",{onClick:()=>g(t.name),className:"btn btn-sm btn-danger",children:"Delete"})]})]},t.name))})]})})]})]})}export{L as default};
