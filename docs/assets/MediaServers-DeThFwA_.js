import{j as e,u as D}from"./index-e2xbirfX.js";import{b as c,c as L,L as w}from"./react-DWbSL3I3.js";function N({open:n,onClose:s,modalType:a="center",children:u}){const l=c.useRef(null),[d,i]=c.useState(n);return c.useEffect(()=>{if(n)i(!0),document.body.style.overflow="hidden",window.history.pushState({modalOpen:!0},"");else{const o=setTimeout(()=>i(!1),300);return document.body.style.overflow="",()=>clearTimeout(o)}},[n]),c.useEffect(()=>{const o=f=>{f.key==="Escape"&&s()},p=()=>{s()};return document.addEventListener("keydown",o),window.addEventListener("popstate",p),()=>{document.removeEventListener("keydown",o),window.removeEventListener("popstate",p)}},[s]),d?e.jsx("div",{ref:l,className:`fixed inset-0 z-50 flex items-center justify-center bg-black/50 transition-opacity duration-300 ${n?"opacity-100":"opacity-0"}`,onClick:o=>{o.target===l.current&&s()},children:e.jsx("div",{className:`box1 p-4 rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 ${P(a,n)}`,style:{width:M(a),height:T(a)},children:u})}):null}function M(n){return n==="full"?"100%":["left","right"].includes(n||"")?"300px":"90%"}function T(n){return n==="full"?"100%":["top","bottom"].includes(n||"")?"300px":"auto"}function P(n,s){switch(n){case"top":return`${s?"translate-y-0 opacity-100":"-translate-y-full opacity-0"} mt-4`;case"bottom":return`${s?"translate-y-0 opacity-100":"translate-y-full opacity-0"} mb-4`;case"left":return`${s?"translate-x-0 opacity-100":"-translate-x-full opacity-0"} ml-4`;case"right":return`${s?"translate-x-0 opacity-100":"translate-x-full opacity-0"} mr-4`;case"full":return`${s?"scale-100 opacity-100":"scale-95 opacity-0"}`;case"center":default:return`${s?"scale-100 opacity-100":"scale-95 opacity-0"}`}}function R({open:n,onClose:s,onConfirm:a,title:u="Confirm",message:l="Are you sure?"}){return n?e.jsxs(N,{open:n,onClose:s,modalType:"center",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:u}),e.jsx("p",{className:"mb-6",children:l}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-300 rounded",children:"Cancel"}),e.jsx("button",{onClick:()=>{a(),s()},className:"px-4 py-2 bg-red-600 text-white rounded",children:"Confirm"})]})]}):null}function z({open:n,onClose:s,initial:a,onSave:u}){const[l,d]=c.useState({name:"",url:"",apiKey:""});return c.useEffect(()=>{d(a||{name:"",url:"",apiKey:""})},[a]),n?e.jsxs(N,{open:n,onClose:s,modalType:"bottom",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:a?"Edit Server":"Add Server"}),e.jsx("input",{className:"border p-2 rounded w-full mb-2",placeholder:"Name",value:l.name,onChange:i=>d(o=>({...o,name:i.target.value})),disabled:!!a}),e.jsx("input",{className:"border p-2 rounded w-full mb-2",placeholder:"URL",value:l.url,onChange:i=>d(o=>({...o,url:i.target.value}))}),e.jsx("input",{className:"border p-2 rounded w-full mb-4",placeholder:"API Key",value:l.apiKey,onChange:i=>d(o=>({...o,apiKey:i.target.value}))}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-300 rounded",children:"Cancel"}),e.jsx("button",{onClick:()=>u(l),className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Save"})]})]}):null}function H(){const s=L().pathname,{config:a,updateConfig:u}=D(),[l,d]=c.useState({}),[i,o]=c.useState({}),[p,f]=c.useState(!1),[E,x]=c.useState(!1),[C,b]=c.useState(null),[h,j]=c.useState(null);c.useEffect(()=>{if(a!=null&&a.servers){const t={};a.serverOrder.forEach(r=>{a.servers[r]&&(t[r]={name:r,...a.servers[r]})}),d(t)}},[a]),c.useEffect(()=>{const t=async()=>{const r={};await Promise.all(Object.entries(l).map(async([m,y])=>{try{(await fetch(`${y.url}/api/ping`,{method:"GET"})).ok?r[m]="online":r[m]="offline"}catch{r[m]="offline"}})),o(r)};Object.keys(l).length>0&&t()},[l]);const g=t=>{const r={},m=[];Object.entries(t).forEach(([v,S])=>{r[v]={url:S.url,apiKey:S.apiKey},m.push(v)});const y={...a,servers:r,serverOrder:m};u(y)},k=()=>{b(null),f(!0)},$=t=>{const r=l[t];r&&(b({...r}),f(!0))},O=t=>{j(t),x(!0)},K=()=>{if(h){const t={...l};delete t[h],g(t),j(null)}x(!1)},A=t=>{const r={...l,[t.name]:{name:t.name,url:t.url,apiKey:t.apiKey}};g(r),f(!1)};return e.jsxs("div",{className:"box",children:[e.jsxs("h4",{className:"flex card-header",children:[e.jsx("span",{className:"grow",children:"Server Manager"}),e.jsx("nav",{className:"",children:e.jsx("button",{onClick:k,className:"btn",children:"Add Server"})})]}),e.jsx("div",{className:"card-body flex-col gap-4",children:Object.entries(l).map(([t,r])=>e.jsxs("div",{className:"card flex gap-2 box p-2",children:[e.jsxs(w,{to:`${s}/${r.name}`,className:"grow",children:[e.jsx("h4",{className:"text-lg font-semibold",children:t}),e.jsx("p",{className:"text-sm text-gray-500",children:r.url}),e.jsxs("p",{className:`text-sm mt-1 ${i[t]==="online"?"text-green-600":"text-red-600"}`,children:["Status: ",i[t]||"unknown"]})]}),e.jsxs("div",{className:"",children:[e.jsx(w,{to:`${s}/${r.name}/settings`,className:"btn",children:"Settings"}),e.jsx("button",{onClick:()=>$(t),className:"btn",children:"Edit"}),e.jsx("button",{onClick:()=>O(t),className:"btn",children:"Delete"})]})]},t))}),e.jsx(z,{open:p,onClose:()=>f(!1),onSave:A,initial:C||void 0}),e.jsx(R,{open:E,onClose:()=>x(!1),onConfirm:K,title:"Delete Server",message:`Are you sure you want to delete server "${h}"?`})]})}export{H as default};
