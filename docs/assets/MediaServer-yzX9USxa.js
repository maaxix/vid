import{j as e,u as U}from"./index-DGmofqpk.js";import{b as r,e as V}from"./react-WPAQU5kY.js";const C=s=>{const t=Math.floor(s/3600),a=Math.floor(s%3600/60),i=Math.floor(s%60);return t>0?`${t}:${a.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${a}:${i.toString().padStart(2,"0")}`},R=s=>new Date(s).toLocaleDateString(),T=({video:s,baseServerUrl:t})=>{var o;const a=s.dataTitle||s.filename,i=((o=s.thumbnailsTime)==null?void 0:o[0])||0,n=`${t}/api/media/data/thumbs/${s.fileId}/${i}`,d=`${t}/api/media/stream/${s.fileId}`;return e.jsx("div",{className:"card-wrapper",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"relative",children:[e.jsx("a",{href:d,target:"__blank",children:e.jsx("img",{src:n,alt:a,className:"w-full h-48 object-cover",onError:u=>{u.target.src=""}})}),e.jsx("div",{className:"pill small vid-time",children:C(s.duration)})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"card-title mb-2",title:a,children:a}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx("span",{className:"pill small",children:R(s.fileUpdateDate)}),e.jsxs("span",{className:"pill small",children:[Math.round(s.fileSize/(1024*1024))," MB"]})]})]})]})})},B=({onSearch:s})=>{const[t,a]=r.useState(""),i=n=>{n.key==="Enter"&&s(t)};return e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",placeholder:"Search videos...",className:"grow",value:t,onChange:n=>a(n.target.value),onKeyDown:i}),e.jsx("button",{className:"btn second",onClick:()=>s(t),children:"Search"})]})};function _(){const{id:s}=V(),{config:t}=U(),[a,i]=r.useState([]),[n,d]=r.useState(!1),[o,u]=r.useState(null),[E,P]=r.useState(""),[x,N]=r.useState(1),[b,D]=r.useState(1),[g,M]=r.useState(""),[c,k]=r.useState(!0),m=r.useRef(null),j=r.useRef(null);console.log(`id=${s}`);const h=r.useCallback(async(l,f="",w=!1)=>{if(!n){d(!0),u(null);try{if(!t.servers[s||""])throw new Error(`Endpoint with name "${s}" not found`);const y=t.servers[s||""].url;console.log("serves"),console.log(t.servers);const p=new URL(y+"/api/media/search",window.location.origin);f&&p.searchParams.append("q",f),p.searchParams.append("page",l.toString()),p.searchParams.append("limit","20");const $=await fetch(p.toString());if(!$.ok)throw new Error("Failed to fetch videos");const S=await $.json();i(w?S.results:L=>[...L,...S.results]),D(S.totalPages),N(l),P(y)}catch(v){u(v instanceof Error?v.message:"An unknown error occurred")}finally{d(!1),c&&k(!1)}}},[n,c]),I=l=>{M(l),N(1),h(1,l,!0)};return r.useEffect(()=>{if(c){h(1,g,!0);return}const l={root:null,rootMargin:"20px",threshold:1};return m.current=new IntersectionObserver(f=>{f[0].isIntersecting&&x<b&&!n&&h(x+1,g)},l),j.current&&m.current.observe(j.current),()=>{m.current&&m.current.disconnect()}},[x,b,n,g,c,h]),e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"card-title p-3 title-primary",children:"Video Search"}),e.jsx(B,{onSearch:I}),o&&e.jsx("div",{className:"card-body border-red-400 text-red-700 px-4",children:o}),!c&&a.length===0&&!n&&e.jsx("div",{className:"card-body text-center py-12",children:e.jsx("p",{className:"text-xl text-gray-600",children:"No videos found"})}),a.length>0&&e.jsx("div",{className:"card-title p-3 title-primary",children:"Video List"}),e.jsx("div",{className:"container-grid",children:a.map(l=>e.jsx(T,{video:l,baseServerUrl:E},l.fileId))}),e.jsx("div",{ref:j,className:"h-10"}),n&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})]})}export{_ as default};
